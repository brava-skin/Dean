# =====================================================
# DEAN BUSINESS RULES - SIMPLIFIED FOR ASC+ CAMPAIGN
# Single Advantage+ Shopping Campaign with 10 creatives (Andromeda requirement)
# =====================================================

version: 3.0
env: prod

# ── Performance Thresholds ───────────────────────────
thresholds:
  ctr:
    asc_plus_floor: 0.008      # Minimum CTR to keep creative alive
  cpa:  # EUR
    asc_plus_max: 40          # Max CPA before kill
  roas:
    asc_plus_min: 1.0         # Min ROAS to keep creative

# ── Minimum Requirements ──────────────────────────────
minimums:
  impressions: 1500
  clicks: 15
  spend_eur: 35

# ── ASC+ Campaign Rules ───────────────────────────────
# Simple rules for ASC+ campaign - always 10 creatives live (Andromeda compliance)
asc_plus:
  minimums:
    min_impressions: 1500
    min_spend_eur: 35
    min_clicks: 15
    min_delivery_hours: 24
    min_link_clicks: 15
  
  keep:
    - {type: "ctr_gte", ctr_gte: 0.015}
    - {type: "ctr_cpm_combo", ctr_gte: 0.012, cpm_lte: 55}
  
  locks:
    - {type: "ctr_cpm_lock", ctr_gte: 0.018, cpm_lte: 55, evaluation_hours: 48, lock_hours: 72}
  
  kill:
    - {type: "ctr_cpm_spend_combo", spend_gte: 45, ctr_lt: 0.01, cpm_gt: 65}
    - {type: "ctr_spend_floor", spend_gte: 60, ctr_lt: 0.007}
    - {type: "cpm_spend_ctr_combo", spend_gte: 60, cpm_gt: 120, ctr_lt: 0.012}
  
  # Engine configuration
  engine:
    consecutive_ticks_required: 2
    
    fairness:
      min_spend_before_kill_eur: 35
      min_runtime_hours: 24
    
    learning:
      max_learning_budget_eur: 60
    
    tripwires:
      lifetime_spend_no_purchase_eur: 60
    
    bayes:
      prior_a: 1.5
      prior_b: 200.0
      sample_count: 16
      kill_prob: 0.85
    
    adaptive_ctr:
      floor_min: 0.008
      floor_scale: 0.80
      min_impressions: 200
    
    fatigue:
      ewma_alpha: 0.40
      drop_pct: 0.25
    
    queue:
      max_launches_per_tick: 10
      maintain_creative_count: 10  # Always keep 10 creatives alive (Andromeda requirement)
    
    attribution_windows: ["7d_click", "1d_view"]

# ── Global Settings ───────────────────────────────────
stability:
  consecutive_ticks: 2
  smoothing_epsilon: 0.0

attribution:
  click_days: 7
  view_days: 1
  roas_source: "computed"

windows:
  day_1: {days: 1}
  day_3: {days: 3}
  day_7: {days: 7}
  last_48h: {hours: 48}

# ── ML System Configuration ──────────────────────────
ml_system:
  enabled: true
  track_ad_copy: true
  track_creative_performance: true
  track_scaling_decisions: true
  learn_from_asc_plus: true
  
  # Data tracking
  track_metrics:
    - "ad_copy"
    - "creative_text"
    - "ad_performance"
    - "creative_performance"
    - "scaling_opportunities"
  
  # Learning parameters
  learning_rate: 0.01
  confidence_threshold: 0.7
  min_samples_for_learning: 10

# ── Economics ─────────────────────────────────────────
economics:
  currency: "EUR"
  breakeven_cpa_env: "BREAKEVEN_CPA"
  cogs_env: "COGS_PER_PURCHASE"
  fx:
    enabled: false
    usd_to_eur_env: "USD_EUR_RATE"
