# =====================================================
# DEAN BUSINESS RULES - SIMPLIFIED FOR ASC+ CAMPAIGN
# Single Advantage+ Shopping Campaign with 10 creatives (Andromeda requirement)
# =====================================================

version: 3.0
env: prod

# ── Performance Thresholds ───────────────────────────
thresholds:
  ctr:
    asc_plus_floor: 0.008      # Minimum CTR to keep creative alive
  cpa:  # EUR
    asc_plus_max: 40          # Max CPA before kill
  roas:
    asc_plus_min: 1.0         # Min ROAS to keep creative

# ── Minimum Requirements ──────────────────────────────
minimums:
  impressions: 200
  clicks: 5
  spend_eur: 20

# ── ASC+ Campaign Rules ───────────────────────────────
# Simple rules for ASC+ campaign - always 5 creatives live
asc_plus:
  minimums:
    min_impressions: 200
    min_spend_eur: 20
    min_clicks: 5
  
  kill:
    # Early performance indicators
    - {type: "zero_performance_quick_kill", spend_gte: 25, ctr_lt: 0.001}
    
    # CPM management
    - {type: "cpm_above", cpm_above: 120, spend_gte: 30}
    - {type: "cpm_above", cpm_above: 100, spend_gte: 40}
    - {type: "cpm_increase", cpm_increase_pct: 80, spend_gte: 25}
    
    # Performance validation
    - {type: "ctr_below", ctr_lt: 0.008, spend_gte: 30}
    - {type: "spend_no_purchase", spend_gte: 60}
    - {type: "atc_no_purchase", atc_gte: 1, spend_gte: 50, days: 3}
    
    # CPA validation
    - {type: "cpa_gte", cpa_gte: 40}
    - {type: "roas_below", roas_lt: 0.8, spend_gte: 50}
    
    # ATC Performance
    - {type: "atc_rate_below", atc_rate_lt: 0.005, spend_gte: 50, clicks_gte: 50}
    - {type: "cost_per_atc_above", cost_per_atc_gte: 15, spend_gte: 40}
  
  # Engine configuration
  engine:
    consecutive_ticks_required: 2
    
    fairness:
      min_spend_before_kill_eur: 20
      min_runtime_hours: 12
    
    learning:
      max_learning_budget_eur: 60
    
    tripwires:
      lifetime_spend_no_purchase_eur: 60
    
    bayes:
      prior_a: 1.5
      prior_b: 200.0
      sample_count: 16
      kill_prob: 0.85
    
    adaptive_ctr:
      floor_min: 0.008
      floor_scale: 0.80
      min_impressions: 200
    
    fatigue:
      ewma_alpha: 0.40
      drop_pct: 0.25
    
    queue:
      max_launches_per_tick: 10
      maintain_creative_count: 10  # Always keep 10 creatives alive (Andromeda requirement)
    
    attribution_windows: ["7d_click", "1d_view"]

# ── Global Settings ───────────────────────────────────
stability:
  consecutive_ticks: 2
  smoothing_epsilon: 0.0

attribution:
  click_days: 7
  view_days: 1
  roas_source: "computed"

windows:
  day_1: {days: 1}
  day_3: {days: 3}
  day_7: {days: 7}
  last_48h: {hours: 48}

# ── ML System Configuration ──────────────────────────
ml_system:
  enabled: true
  track_ad_copy: true
  track_creative_performance: true
  track_scaling_decisions: true
  learn_from_asc_plus: true
  
  # Data tracking
  track_metrics:
    - "ad_copy"
    - "creative_text"
    - "ad_performance"
    - "creative_performance"
    - "scaling_opportunities"
  
  # Learning parameters
  learning_rate: 0.01
  confidence_threshold: 0.7
  min_samples_for_learning: 10

# ── Economics ─────────────────────────────────────────
economics:
  currency: "EUR"
  breakeven_cpa_env: "BREAKEVEN_CPA"
  cogs_env: "COGS_PER_PURCHASE"
  fx:
    enabled: false
    usd_to_eur_env: "USD_EUR_RATE"
