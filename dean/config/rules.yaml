# =====================================================
# DEAN BUSINESS RULES - ASC+ ATC TRAINING CAMPAIGN
# Goal: Increase ATC signal density while maintaining creative learning time
# Always keep 10 active creatives
# =====================================================

version: 4.3
env: prod

# Performance reference thresholds
thresholds:
  ctr:
    floor: 0.010
    healthy: 0.014
  cpc:
    soft_ceiling: 1.50
    warning_ceiling: 1.90
  cpm:
    soft_ceiling: 60
    warning_ceiling: 80
  atc:
    soft_floor: 1.0
    healthy: 3.0       # UPDATED: healthy ATC increased from 2.5 → 3.0

# Minimum requirements for fair evaluation
minimums:
  impressions: 2500
  spend_eur: 55
  runtime_hours: 48

asc_plus_atc:
  minimums:
    min_impressions: 2500
    min_spend_eur: 55
    min_runtime_hours: 48

  keep:
    # Strong CTR alone is positive (even under Andromeda)
    - {type: "ctr_gte", ctr_gte: 0.012}

    # Strong click efficiency + normal CPM
    - {type: "ctr_cpm_combo", ctr_gte: 0.010, cpm_lte: 55}

    # Strong ATC signaling (even if CTR mid-range)
    - {type: "atc_signal_lock", atc_gte: 3, spend_gte: 55}   # UPDATED from 2 → 3

  locks:
    # Protect real winners from removal
    - {type: "performance_lock", ctr_gte: 0.014, cpm_lte: 50, atc_gte: 3, evaluation_hours: 72, lock_hours: 96} 
      # UPDATED: atc_gte 2 → 3

  kill:
    # Low CTR after spend threshold: creative doesn't create desire
    - {type: "ctr_spend_floor", spend_gte: 45, ctr_lt: 0.008}   # UPDATED: spend 60 → 45

    # CPC too high = low value traffic, even if CTR passable
    - {type: "cpc_spend_combo", spend_gte: 50, cpc_gt: 1.90}    # UPDATED: spend 70 → 50

    # Expensive delivery + weak attention
    - {type: "cpm_ctr_combo", cpm_gt: 80, ctr_lt: 0.009}

    # Clear ATC failure after fair learning window
    - {type: "atc_efficiency_fail", spend_gte: 55, atc_lt: 1}   # UPDATED: spend 75 → 55

  engine:
    consecutive_ticks_required: 2

    fairness:
      min_spend_before_kill_eur: 55
      min_runtime_hours: 48

    learning:
      max_learning_budget_eur: 150

    queue:
      maintain_creative_count: 10
      max_creative_turnover_per_24h: 0.15
      new_creative_grace_hours: 36

  attribution_windows: ["7d_click", "1d_view"]

# Stability controls
stability:
  consecutive_ticks: 2
  smoothing_epsilon: 0.0

windows:
  day_1: {days: 1}
  day_3: {days: 3}
  day_7: {days: 7}
  last_48h: {hours: 48}

ml_system:
  enabled: true
  learn_from_asc_plus: true
  learning_rate: 0.01
  confidence_threshold: 0.7
  min_samples_for_learning: 12

economics:
  currency: "EUR"
